import{C as e,D as s,E as o,d as a,r as l,j as n,z as t,c,w as u,i as r,A as i,s as d,o as f,a as p,u as g,e as v,f as w,k as _,F as m,m as k,t as U,g as b,n as y}from"./index-BUzATzdh.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";function x(e,s){return`作为技术面试官，请对以下回答进行评估，并严格分步返回结果：\n\n                    问题：${e}\n                    答案：${s}\n\n                    请按以下步骤返回 JSON 结果，每一步均为完整对象：\n                    1. 评分（仅含分数）：\n                    {"score": 0-100的整数}\n                    \n                    2. 评价（分数+评价）：\n                    {"score": 同上, "feedback": "面试官口吻的详细评价，中文，非空"}\n                    \n                    3. 建议（分数+评价+建议）：\n                    {"score": 同上, "feedback": 同上, "suggestions": "导师口吻的改进建议，中文，非空"}\n                    \n                    4. 范例（分数+评价+建议+范例）：\n                    {"score": 同上, "feedback": 同上, "suggestions": 同上, "example": "标准答案示例，中文，非空"}\n                    \n                    5. 最终结果（含追问判断）：\n                    {"score": 同上, "feedback": 同上, "suggestions": 同上, "example": 同上, "needFollowUp": true/false, "followUpQuestion": "不要随意追问，若需追问，此处为非空中文问题"}\n                    \n                    注意：\n                    1. score 需综合准确性（0-40）、完整性（0-30）、清晰度（0-20）、逻辑性（0-10）评分。\n                    2. 所有文本字段必须为非空中文，禁止缺失或混合其他语言。\n                    3. 以面试官角度考虑该面试者是否值得追问或引导，若需要则将 needFollowUp 设置为 true，否则为 false。\n                    3. needFollowUp 为 true 时，followUpQuestion 必须是与原问题强相关、能进一步考察候选人技术深度的追问问题，避免开放式提问。\n                `}function F(e){return{model:s.value.model,temperature:s.value.temperature,response_format:{type:"json_object"},messages:[{role:"system",content:"你是一位经验丰富的技术面试官，善于评估候选人的回答并提供建设性的反馈。"},{role:"user",content:e}]}}function Q(){return{baseURL:s.value.baseURL,apiKey:s.value.apiKey}}async function O(s,a,l){return new Promise((async(n,t)=>{try{let c=function(e){try{return JSON.parse(e),e}catch(s){return e.endsWith(",")&&(e=e.slice(0,-1)),e.endsWith('"')?e+="}":e.endsWith('"')||e.endsWith("}")||(e+='"}'),e}},u="",r={score:-1,feedback:"",suggestions:"",example:"",needFollowUp:!1,followUpQuestion:""},i=e({url:"ws://localhost:18780",complete:()=>{}});i.onOpen((()=>{const e=Q(),o={...F(x(s,a)),baseURL:e.baseURL,apiKey:e.apiKey};i.send({data:JSON.stringify(o),fail:e=>{console.error("发送消息失败:",e),t(new Error("发送消息失败"))}})})),i.onMessage((e=>{var s,o,a,d;try{const p=JSON.parse(e.data);if(p.error)return i.close({}),void t(new Error(p.error));if(null==(o=null==(s=p.choices)?void 0:s[0])?void 0:o.delta){const e=p.choices[0].delta;if(e.content){u+=e.content;try{const e=JSON.parse(c(u));r.score=e.score,r.feedback=e.feedback||"",r.suggestions=e.suggestions||"",r.example=e.example||"",r.needFollowUp=e.needFollowUp||!1,r.followUpQuestion=e.followUpQuestion||"",l&&l(r)}catch(f){}}}if("stop"===(null==(d=null==(a=p.choices)?void 0:a[0])?void 0:d.finish_reason))return i.close({}),void n(r)}catch(p){console.error("处理消息时出错:",p)}})),i.onError((async e=>{console.warn("WebSocket 连接失败，降级使用 HTTP 请求:",e),r=await async function(s,a){return new Promise(((l,n)=>{const t=Q(),c=F(x(s,a));o({url:`${t.baseURL}/chat/completions`,method:"POST",header:{"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},timeout:18e4,data:c,success:s=>{try{const e=s.data.choices[0].message.content,o=JSON.parse(e);l({score:o.score,feedback:o.feedback||"",suggestions:o.suggestions||"",example:o.example||"",needFollowUp:o.needFollowUp||!1,followUpQuestion:o.followUpQuestion||""})}catch(e){n(new Error("解析评估结果失败"))}},fail:e=>{n(new Error("请求评估失败"))}})}))}(s,a),console.warn("降级使用 HTTP 请求结果:",r),l&&l(r),n(r)})),i.onClose((()=>{r.score>=0&&!r.feedback&&!r.suggestions&&n(r)}))}catch(c){t(c)}}))}const S=h(a({__name:"evaluation",setup(e){const s=l({score:-1,feedback:"",suggestions:"",example:"",needFollowUp:!1});n((()=>{var e;const o=null==(e=i())?void 0:e.proxy,a=null==o?void 0:o.getOpenerEventChannel();a&&a.on?a.on("evaluateAnswer",(async e=>{try{const o=await O(e.question,e.answer,(e=>{s.value={score:void 0===e.score?-1:e.score,feedback:e.feedback||"",suggestions:e.suggestions||"",example:e.example||"",needFollowUp:e.needFollowUp||!1,followUpQuestion:e.followUpQuestion||""}}));s.value=o}catch(o){console.error("评估失败",o),d({title:"评估失败，请重试",icon:"none"})}})):t({url:"/pages/index/index"})}));const o=()=>{var e;(null==(e=s.value)?void 0:e.followUpQuestion)&&y({url:"/pages/question-bank/answer",success:e=>{var o;e.eventChannel.emit("setQuestion",{question:null==(o=s.value)?void 0:o.followUpQuestion,isFollowUp:!0})}})};return(e,a)=>{const l=v,n=r,t=b;return f(),c(n,{class:"content"},{default:u((()=>[p(n,{class:"evaluation-section"},{default:u((()=>[p(n,{class:"evaluation-card"},{default:u((()=>[p(n,{class:"score-section"},{default:u((()=>[p(l,{class:"score-label"},{default:u((()=>[w("得分")])),_:1}),p(l,{class:"score-value"},{default:u((()=>[s.value.score<0||!s.value.feedback?(f(),c(l,{key:0,class:"loading-container"},{default:u((()=>[p(l,{class:"loading-text"},{default:u((()=>[w("评估中")])),_:1}),p(l,{class:"loading-dots"},{default:u((()=>[(f(),_(m,null,k(3,(e=>p(l,{class:"dot"},{default:u((()=>[w(".")])),_:1}))),64))])),_:1})])),_:1})):(f(),c(l,{key:1},{default:u((()=>[w(U(s.value.score),1)])),_:1}))])),_:1})])),_:1}),s.value.score<0||!s.value.feedback?(f(),c(n,{key:0,class:"placeholder-sections"},{default:u((()=>[(f(),_(m,null,k(3,(e=>p(n,{class:"placeholder-section"},{default:u((()=>[p(n,{class:"placeholder-title"}),p(n,{class:"placeholder-content"})])),_:1}))),64))])),_:1})):(f(),c(n,{key:1},{default:u((()=>[s.value.feedback?(f(),c(n,{key:0,class:"feedback-section"},{default:u((()=>[p(l,{class:"feedback-title"},{default:u((()=>[w("评价")])),_:1}),p(l,{class:"feedback-content"},{default:u((()=>[w(U(s.value.feedback),1)])),_:1})])),_:1})):g("",!0),s.value.suggestions?(f(),c(n,{key:1,class:"suggestions-section"},{default:u((()=>[p(l,{class:"suggestions-title"},{default:u((()=>[w("建议")])),_:1}),p(l,{class:"suggestions-content"},{default:u((()=>[w(U(s.value.suggestions),1)])),_:1})])),_:1})):g("",!0),s.value.example?(f(),c(n,{key:2,class:"example-section"},{default:u((()=>[p(l,{class:"example-title"},{default:u((()=>[w("范例")])),_:1}),p(l,{class:"example-content"},{default:u((()=>[w(U(s.value.example),1)])),_:1})])),_:1})):g("",!0),s.value.needFollowUp?(f(),c(n,{key:3,class:"follow-up-section"},{default:u((()=>[p(l,{class:"follow-up-title"},{default:u((()=>[w("追问")])),_:1}),p(l,{class:"follow-up-content"},{default:u((()=>[w(U(s.value.followUpQuestion),1)])),_:1})])),_:1})):g("",!0)])),_:1}))])),_:1})])),_:1}),s.value.needFollowUp?(f(),c(t,{key:0,class:"follow-up-btn",onClick:o},{default:u((()=>[w("继续回答")])),_:1})):g("",!0)])),_:1})}}}),[["__scopeId","data-v-831acc2a"]]);export{S as default};
